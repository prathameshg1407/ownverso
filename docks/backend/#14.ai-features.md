Below is the **AI Features** documentation (Category: ~38 endpoints), in the same structure as earlier sections.

Treat this as: `docs/backend/ai-features.md`.

---

# AI Features – Technical Documentation

## 1. Purpose & Scope

The **AI Features** module covers:

- **AI Writing Assistant**:
  - Brainstorming, outlines, expansions, dialogue, descriptions, editing, proofreading, titles, blurbs
  - Logs each session (`AIWritingSession`) with model metadata and feedback

- **AI Translation (generic)**:
  - On-demand text and chapter translation
  - Language detection
  - Not the same as persisted `SeriesTranslation`/`ChapterTranslation` (documented in Translations), but can power them

- **AI Cover Generation**:
  - Generate or suggest cover images via AI art models
  - Potentially used as input to Media & Files

- **TikTok-style video previews**:
  - Generate promotional short videos for chapters (`TikTokPreview`, `TikTokTemplate`)
  - Track generation status

- **OCR for Comics**:
  - Extract text from images (`OCRJob`)
  - Manage translated text replacements (`ComicTextReplacement`)

- **AI Usage Tracking**:
  - Track tokens/words used per user and billing period (`AIUsageRecord`)
  - Enforce or display limits by tier

These features integrate with:

- **Author & Site Management** (author tools)
- **Content Management** (chapters & series)
- **Translations** (glossary application, persisted translations)
- **Tier Limits / Billing** (usage caps per platform tier)
- **Media & Files** (covers, TikTok videos, OCR images)

---

## 2. Prisma Schema (Models & Enums)

### 2.1 Enums

From schema; repeated here.

```prisma
enum AIModel {
  GPT_4
  GPT_4_TURBO
  GPT_4O
  GPT_4O_MINI
  CLAUDE_3_OPUS
  CLAUDE_3_SONNET
  CLAUDE_3_HAIKU
  CLAUDE_3_5_SONNET
  GEMINI_PRO
  GEMINI_ULTRA
  LLAMA_3
  MISTRAL_LARGE
  CUSTOM
}

enum AISessionType {
  BRAINSTORMING
  OUTLINE
  PLOT_DEVELOPMENT
  CHARACTER_DEVELOPMENT
  WORLD_BUILDING
  DIALOGUE
  DESCRIPTION
  EDITING
  PROOFREADING
  TRANSLATION
  SUMMARIZATION
  EXPANSION
  TITLE_GENERATION
  BLURB_WRITING
  CUSTOM
}

enum TikTokPreviewStatus {
  PENDING
  QUEUED
  GENERATING
  READY
  PUBLISHED
  FAILED
}

enum JobStatus {
  PENDING
  SCHEDULED
  PROCESSING
  COMPLETED
  FAILED
  CANCELLED
  RETRYING
  STALLED
  DEAD
}
```

### 2.2 Models

#### 2.2.1 `AIWritingSession`

```prisma
model AIWritingSession {
  id     BigInt @id @default(autoincrement())
  userId BigInt

  seriesId  String?
  chapterId String?

  sessionType  AISessionType
  prompt       String @db.Text
  systemPrompt String? @db.Text
  response     String @db.Text

  model            AIModel
  tokensUsed       Int
  promptTokens     Int?
  completionTokens Int?
  estimatedCost    Float?

  wasHelpful    Boolean?
  helpfulRating Int?     @db.SmallInt // 1-5
  feedback      String?  @db.Text

  responseTimeMs Int?

  createdAt DateTime @default(now())

  user    User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  series  Series?  @relation(fields: [seriesId], references: [id], onDelete: SetNull)
  chapter Chapter? @relation(fields: [chapterId], references: [id], onDelete: SetNull)

  @@index([userId, sessionType])
  @@index([seriesId])
  @@index([model, createdAt])

  @@map("ai_writing_sessions")
}
```

#### 2.2.2 `AIUsageRecord`

```prisma
model AIUsageRecord {
  id     BigInt @id @default(autoincrement())
  userId BigInt

  periodStart DateTime
  periodEnd   DateTime

  translationWordsUsed Int      @default(0)
  translationRequests  Int      @default(0)
  translationLanguages String[] @default([])

  writingTokensUsed Int @default(0)
  writingRequests   Int @default(0)

  coverGenerationsUsed  Int @default(0) @db.SmallInt
  tiktokVideosGenerated Int @default(0) @db.SmallInt

  // Limits for this period (copied from tier at time of creation)
  translationWordsLimit Int? 
  writingTokensLimit    Int?
  coverGenerationsLimit Int? @db.SmallInt
  tiktokVideosLimit     Int? @db.SmallInt

  // Overage
  translationOverage Int    @default(0)
  writingOverage     Int    @default(0)
  overageCharged     BigInt @default(0)
  overageCurrency    String @default("INR") @db.Char(3)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, periodStart])
  @@index([userId, periodStart])

  @@map("ai_usage_records")
}
```

#### 2.2.3 `TikTokPreview`

```prisma
model TikTokPreview {
  id        String @id @default(cuid())
  chapterId String

  videoUrl     String  @db.VarChar(2048)
  thumbnailUrl String? @db.VarChar(2048)
  duration     Int     @db.SmallInt

  width  Int @default(1080) @db.SmallInt
  height Int @default(1920) @db.SmallInt

  fileSize Int
  mimeType String @default("video/mp4") @db.VarChar(50)

  status         TikTokPreviewStatus @default(PENDING)
  generationTime Int?

  templateId String?
  style      Json?

  textContent String? @db.Text
  textStyle   Json?

  audioTrackId  String?
  audioTrackUrl String? @db.VarChar(2048)
  hasVoiceover  Boolean @default(false)
  voiceId       String?

  errorMessage String?
  retryCount   Int     @default(0) @db.SmallInt

  isPublished Boolean   @default(false)
  publishedAt DateTime?

  tiktokPostId    String?
  tiktokPostUrl   String? @db.VarChar(2048)
  instagramPostId String?
  youtubeShortsId String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  chapter Chapter @relation(fields: [chapterId], references: [id], onDelete: Cascade)

  @@index([chapterId])
  @@index([status])

  @@map("tiktok_previews")
}
```

#### 2.2.4 `TikTokTemplate`

```prisma
model TikTokTemplate {
  id          String  @id @default(cuid())
  name        String  @db.VarChar(100)
  slug        String  @unique
  description String? @db.Text

  thumbnailUrl String? @db.VarChar(2048)
  previewUrl   String? @db.VarChar(2048)

  config       Json
  contentTypes ContentType[] @default([])

  isPublic     Boolean       @default(true)
  isPremium    Boolean       @default(false)
  requiredTier PlatformTier?

  usageCount Int @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([slug])
  @@index([isPublic, isPremium])

  @@map("tiktok_templates")
}
```

#### 2.2.5 `OCRJob`

```prisma
model OCRJob {
  id             BigInt @id @default(autoincrement())
  chapterImageId BigInt

  status       JobStatus @default(PENDING)
  startedAt    DateTime?
  completedAt  DateTime?
  errorMessage String?

  extractedText     String? @db.Text
  textBoundingBoxes Json?
  textRegionsCount  Int     @default(0) @db.SmallInt

  detectedLanguage   String? @db.Char(2)
  languageConfidence Float?

  processingTimeMs Int?
  modelUsed        String?
  imageRegions     Int?    @db.SmallInt

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  chapterImage ChapterImage @relation(fields: [chapterImageId], references: [id], onDelete: Cascade)

  @@index([chapterImageId])
  @@index([status])

  @@map("ocr_jobs")
}
```

#### 2.2.6 `ComicTextReplacement`

```prisma
model ComicTextReplacement {
  id             BigInt @id @default(autoincrement())
  chapterImageId BigInt

  language String @db.Char(2)

  originalText   String
  originalBounds Json

  translatedText   String
  replacementStyle Json

  isApplied      Boolean   @default(false)
  appliedAt      DateTime?
  resultImageId  String?
  resultImageUrl String?   @db.VarChar(2048)

  isManualEdit Boolean   @default(false)
  editedById   BigInt?
  editedByName String?
  editedAt     DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  chapterImage ChapterImage @relation(fields: [chapterImageId], references: [id], onDelete: Cascade)

  @@unique([chapterImageId, language, originalText])
  @@index([chapterImageId, language])

  @@map("comic_text_replacements")
}
```

These models and enums are the core of AI Features.

---

## 3. Backend Implementation

### 3.1 Route & Handler Structure

**Base module:** `src/api/v1/ai/`

We group by:

- Writing assistant
- Translation
- Covers
- TikTok previews
- OCR
- Usage

#### 3.1.1 AI Writing Assistant – `src/api/v1/ai/writing/`

```text
src/api/v1/ai/writing/
  index.ts
  ai-writing.controller.ts
  ai-writing.service.ts
  ai-writing.schema.ts
  ai-writing.test.ts

  handlers/
    brainstorm.handler.ts          # POST /ai/writing/brainstorm
    outline.handler.ts             # POST /ai/writing/outline
    expand.handler.ts              # POST /ai/writing/expand
    dialogue.handler.ts            # POST /ai/writing/dialogue
    describe.handler.ts            # POST /ai/writing/describe
    edit.handler.ts                # POST /ai/writing/edit
    proofread.handler.ts           # POST /ai/writing/proofread
    summarize.handler.ts           # POST /ai/writing/summarize
    title.handler.ts               # POST /ai/writing/title
    blurb.handler.ts               # POST /ai/writing/blurb
    custom.handler.ts              # POST /ai/writing/custom (optional generic)

    sessions/
      list-sessions.handler.ts     # GET /ai/writing/sessions
      get-session.handler.ts       # GET /ai/writing/sessions/{id}
      submit-feedback.handler.ts   # POST /ai/writing/sessions/{id}/feedback
```

Each handler:

- Validates input (prompt, context).
- Calls AI orchestrator service with proper `sessionType`.
- Saves `AIWritingSession`.
- Updates `AIUsageRecord` (writingTokensUsed, writingRequests).

#### 3.1.2 AI Translation (Generic) – `src/api/v1/ai/translate/`

```text
src/api/v1/ai/translate/
  index.ts
  ai-translate.controller.ts
  ai-translate.service.ts
  ai-translate.schema.ts
  ai-translate.test.ts

  handlers/
    translate-text.handler.ts      # POST /ai/translate
    translate-chapter.handler.ts   # POST /ai/translate/chapter
    detect-language.handler.ts     # POST /ai/translate/detect
    list-languages.handler.ts      # GET /ai/translate/languages
```

These endpoints perform **ephemeral** translations, not necessarily stored. Persisted series/chapter translations are in the Translations module.

#### 3.1.3 AI Cover – `src/api/v1/ai/cover/`

```text
src/api/v1/ai/cover/
  index.ts
  ai-cover.controller.ts
  ai-cover.service.ts
  ai-cover.schema.ts
  ai-cover.test.ts

  handlers/
    generate-cover.handler.ts      # POST /ai/cover/generate
    list-styles.handler.ts         # GET /ai/cover/styles
    generate-variations.handler.ts # POST /ai/cover/variations
```

These call image-generation AI providers and then hand resulting images to Media/Storage.

#### 3.1.4 TikTok Previews – `src/api/v1/ai/tiktok/`

```text
src/api/v1/ai/tiktok/
  index.ts
  ai-tiktok.controller.ts
  ai-tiktok.service.ts
  ai-tiktok.schema.ts
  ai-tiktok.test.ts

  handlers/
    get-preview.handler.ts         # GET /chapters/{chapterId}/tiktok-preview
    generate-preview.handler.ts    # POST /chapters/{chapterId}/tiktok-preview
    update-preview.handler.ts      # PUT /chapters/{chapterId}/tiktok-preview
    delete-preview.handler.ts      # DELETE /chapters/{chapterId}/tiktok-preview
    publish-preview.handler.ts     # POST /chapters/{chapterId}/tiktok-preview/publish
    list-templates.handler.ts      # GET /ai/tiktok/templates
```

#### 3.1.5 OCR & Comic Text Replacement – `src/api/v1/ai/ocr/`

```text
src/api/v1/ai/ocr/
  index.ts
  ai-ocr.controller.ts
  ai-ocr.service.ts
  ai-ocr.schema.ts
  ai-ocr.test.ts

  handlers/
    extract-text.handler.ts         # POST /ai/ocr/extract
    get-job-status.handler.ts       # GET /ai/ocr/jobs/{id}
    translate-text.handler.ts       # POST /ai/ocr/translate
    create-replacement.handler.ts   # POST /ai/ocr/replace
    list-replacements.handler.ts    # GET /chapters/{chapterId}/text-replacements
    update-replacement.handler.ts   # PUT /chapters/{chapterId}/text-replacements/{id}
    // Optionally DELETE /chapters/{chapterId}/text-replacements/{id}
```

- `extract-text` schedules `OCRJob` (JobQueue) for `ChapterImage`.
- `translate-text` uses AI translation or simple translation API.
- `create-replacement` generates `ComicTextReplacement`.
- `list/update` manage replacements for editing & applying overlays.

#### 3.1.6 Usage Tracking – `src/api/v1/ai/usage/`

```text
src/api/v1/ai/usage/
  index.ts
  ai-usage.controller.ts
  ai-usage.service.ts
  ai-usage.schema.ts
  ai-usage.test.ts

  handlers/
    get-usage.handler.ts            # GET /ai/usage
    get-usage-history.handler.ts    # GET /ai/usage/history
    get-limits.handler.ts           # GET /ai/limits
```

Admin-level AI usage analytics may live in Analytics/Admin modules.

### 3.2 Domain Layer

**Module:** `src/domain/ai/`

```text
src/domain/ai/
  entities/
    ai-writing-session.entity.ts
    ai-usage-record.entity.ts
    tiktok-preview.entity.ts
    ocr-job.entity.ts
    comic-text-replacement.entity.ts

  repositories/
    ai-writing-session.repository.ts
    ai-usage-record.repository.ts
    tiktok-preview.repository.ts
    ocr-job.repository.ts
    comic-text-replacement.repository.ts

  services/
    ai-writing.service.ts
    ai-translation.service.ts
    ai-cover.service.ts
    ai-usage.service.ts
    tiktok-preview.service.ts
    ocr.service.ts
```

**Infrastructure:** `src/infrastructure/ai/`

```text
src/infrastructure/ai/
  ai.interface.ts
  orchestrator.service.ts          # Selects best model/provider, handles retries
  providers/
    openai.provider.ts             # creative writing, summarization, editing
    anthropic.provider.ts          # alt writing models
    deepl.provider.ts              # translation
    vision.provider.ts             # OCR (Google Vision/Azure OCR)
    image-generation.provider.ts   # for covers / tiktok backgrounds
```

**Usage Service** increments `AIUsageRecord` based on:

- tokens for writing sessions
- translation word counts
- cover generation count
- TikTok preview count

It pulls per-user tier limits from `TierLimits` and caches per period.

---

## 4. Frontend Implementation (Next.js)

### 4.1 AI Writing UI

Used in the chapter editor and dedicated AI tools page.

#### 4.1.1 In Editor

`src/app/(author)/editor/[chapterId]/_components/ai-assistant-panel.tsx`:

```text
ai-assistant-panel.tsx
ai-suggestion-panel.tsx
ai-prompt-input.tsx
ai-response-display.tsx
ai-usage-indicator.tsx
```

Integrates with `use-ai-writing` hook and `ai/writing` endpoints.

#### 4.1.2 Dedicated AI Tools Page

`src/app/(author)/ai/writing/`:

```text
src/app/(author)/ai/writing/
  page.tsx                           # /ai/writing – workspace for brainstorming, outlines
  _components/
    writing-tools-sidebar.tsx
    brainstorming-widget.tsx
    outline-widget.tsx
    character-builder-widget.tsx
    world-building-widget.tsx
    title-generator-widget.tsx
    blurb-generator-widget.tsx
```

### 4.2 AI Translation UI

Most persisted translation UI lives in Translations module, but generic AI translation tools may exist:

`src/app/(author)/ai/translation/`:

```text
page.tsx
_components/
  translation-textarea.tsx
  translation-result.tsx
  language-selector.tsx
```

### 4.3 AI Cover UI

`src/app/(author)/ai/covers/`:

```text
page.tsx                           # /ai/covers
_components/
  cover-prompt-form.tsx
  cover-style-selector.tsx
  cover-preview-grid.tsx
  cover-variation-controls.tsx
  apply-as-series-cover-button.tsx
```

### 4.4 TikTok Preview UI

Under series/chapters or dedicated page:

```text
src/app/(author)/series/[seriesId]/chapters/[chapterId]/tiktok/
  page.tsx                           # Manage TikTok preview for chapter
  _components/
    tiktok-preview-player.tsx
    tiktok-template-selector.tsx
    tiktok-preview-form.tsx
    tiktok-status-badge.tsx
    publish-to-platforms-buttons.tsx
```

Also generic template list:

```text
src/app/(author)/ai/tiktok-templates/
  page.tsx
  _components/
    tiktok-template-card.tsx
    tiktok-template-grid.tsx
```

### 4.5 OCR & Comic Text Replacement UI

In comic editor:

```text
src/app/(author)/editor/[chapterId]/_components/
  comic-ocr-panel.tsx
  ocr-job-status.tsx
  text-region-annotator.tsx
  replacement-editor.tsx
  language-switcher.tsx
```

---

## 5. Hooks & Frontend API Clients

### 5.1 Hooks

```text
src/hooks/
  // AI writing
  use-ai-writing.ts                  # generic hook to call /ai/writing/* by type
  use-ai-writing-sessions.ts         # list past sessions
  use-ai-writing-session-detail.ts   # view one session
  use-ai-writing-feedback.ts         # submit helpfulness feedback

  // Translation
  use-ai-translate.ts                # text translation
  use-ai-translate-chapter.ts        # chapter translation preview
  use-ai-detect-language.ts
  use-ai-languages.ts

  // Covers
  use-ai-cover-generate.ts
  use-ai-cover-styles.ts
  use-ai-cover-variations.ts

  // TikTok
  use-tiktok-preview.ts              # get current preview for chapter
  use-generate-tiktok-preview.ts
  use-update-tiktok-preview.ts
  use-delete-tiktok-preview.ts
  use-publish-tiktok-preview.ts
  use-tiktok-templates.ts

  // OCR
  use-ocr-extract.ts
  use-ocr-job-status.ts
  use-ocr-translate.ts
  use-comic-replacements.ts
  use-update-comic-replacement.ts
  use-create-comic-replacement.ts

  // Usage
  use-ai-usage.ts
  use-ai-usage-history.ts
  use-ai-limits.ts
```

### 5.2 Frontend API Endpoints

```text
src/lib/api/endpoints/ai-writing.ts

export const aiWritingApi = {
  brainstorm: (data: WritingPromptDto) =>
    api.post<AIWritingSessionDto>('/ai/writing/brainstorm', data),
  outline: (data: WritingPromptDto) =>
    api.post<AIWritingSessionDto>('/ai/writing/outline', data),
  expand: (data: WritingPromptDto) =>
    api.post<AIWritingSessionDto>('/ai/writing/expand', data),
  dialogue: (data: WritingPromptDto) =>
    api.post<AIWritingSessionDto>('/ai/writing/dialogue', data),
  describe: (data: WritingPromptDto) =>
    api.post<AIWritingSessionDto>('/ai/writing/describe', data),
  edit: (data: EditingPromptDto) =>
    api.post<AIWritingSessionDto>('/ai/writing/edit', data),
  proofread: (data: EditingPromptDto) =>
    api.post<AIWritingSessionDto>('/ai/writing/proofread', data),
  summarize: (data: SummarizePromptDto) =>
    api.post<AIWritingSessionDto>('/ai/writing/summarize', data),
  title: (data: TitlePromptDto) =>
    api.post<AIWritingSessionDto>('/ai/writing/title', data),
  blurb: (data: BlurbPromptDto) =>
    api.post<AIWritingSessionDto>('/ai/writing/blurb', data),
  custom: (data: CustomAISessionDto) =>
    api.post<AIWritingSessionDto>('/ai/writing/custom', data),

  listSessions: (params?: AISessionQueryParams) =>
    api.get<Paginated<AIWritingSessionDto>>('/ai/writing/sessions', params),
  getSession: (id: number | string) =>
    api.get<AIWritingSessionDto>(`/ai/writing/sessions/${id}`),
  submitFeedback: (id: number | string, data: AIWritingFeedbackDto) =>
    api.post<void>(`/ai/writing/sessions/${id}/feedback`, data),
};
```

```text
src/lib/api/endpoints/ai-translate.ts

export const aiTranslateApi = {
  translateText: (data: TranslateTextDto) =>
    api.post<TranslateResultDto>('/ai/translate', data),
  translateChapter: (data: TranslateChapterDto) =>
    api.post<TranslateChapterResultDto>('/ai/translate/chapter', data),
  detectLanguage: (data: DetectLanguageDto) =>
    api.post<DetectLanguageResultDto>('/ai/translate/detect', data),
  listLanguages: () =>
    api.get<TranslationLanguageDto[]>('/ai/translate/languages'),
};
```

```text
src/lib/api/endpoints/ai-cover.ts

export const aiCoverApi = {
  generateCover: (data: GenerateCoverDto) =>
    api.post<CoverResultDto>('/ai/cover/generate', data),
  listStyles: () =>
    api.get<CoverStyleDto[]>('/ai/cover/styles'),
  generateVariations: (data: GenerateCoverVariationsDto) =>
    api.post<CoverResultDto[]>('/ai/cover/variations', data),
};
```

```text
src/lib/api/endpoints/ai-tiktok.ts

export const aiTiktokApi = {
  getPreview: (chapterId: string) =>
    api.get<TikTokPreviewDto>(`/chapters/${chapterId}/tiktok-preview`),
  generatePreview: (chapterId: string, data: GenerateTikTokPreviewDto) =>
    api.post<TikTokPreviewDto>(`/chapters/${chapterId}/tiktok-preview`, data),
  updatePreview: (chapterId: string, data: UpdateTikTokPreviewDto) =>
    api.put<TikTokPreviewDto>(`/chapters/${chapterId}/tiktok-preview`, data),
  deletePreview: (chapterId: string) =>
    api.delete<void>(`/chapters/${chapterId}/tiktok-preview`),
  publishPreview: (chapterId: string, data?: PublishTikTokPreviewDto) =>
    api.post<void>(`/chapters/${chapterId}/tiktok-preview/publish`, data || {}),
  listTemplates: (params?: TikTokTemplateQueryParams) =>
    api.get<TikTokTemplateDto[]>('/ai/tiktok/templates', params),
};
```

```text
src/lib/api/endpoints/ai-ocr.ts

export const aiOcrApi = {
  extractText: (data: ExtractOcrDto) =>
    api.post<OCRJobDto>('/ai/ocr/extract', data),
  getJobStatus: (id: number | string) =>
    api.get<OCRJobDto>(`/ai/ocr/jobs/${id}`),
  translateText: (data: OcrTranslateDto) =>
    api.post<OcrTranslateResultDto>('/ai/ocr/translate', data),
  createReplacement: (data: CreateComicReplacementDto) =>
    api.post<ComicTextReplacementDto>('/ai/ocr/replace', data),
  listReplacements: (chapterId: string, params?: ReplacementQueryParams) =>
    api.get<ComicTextReplacementDto[]>(`/chapters/${chapterId}/text-replacements`, params),
  updateReplacement: (chapterId: string, id: number | string, data: UpdateComicReplacementDto) =>
    api.put<ComicTextReplacementDto>(`/chapters/${chapterId}/text-replacements/${id}`, data),
  // Optional delete
  deleteReplacement: (chapterId: string, id: number | string) =>
    api.delete<void>(`/chapters/${chapterId}/text-replacements/${id}`),
};
```

```text
src/lib/api/endpoints/ai-usage.ts

export const aiUsageApi = {
  getUsage: () =>
    api.get<AIUsageSummaryDto>('/ai/usage'),
  getUsageHistory: (params?: AIUsageHistoryQueryParams) =>
    api.get<Paginated<AIUsageRecordDto>>('/ai/usage/history', params),
  getLimits: () =>
    api.get<AILimitsDto>('/ai/limits'),
};
```

---

## 6. API Reference – AI Features (~38 Endpoints)

Base URL: `https://api.ownverso.com/v1`

### 6.1 AI Writing Assistant (~12–13 endpoints)

1. **POST `/ai/writing/brainstorm`**  
   Generate ideas given a prompt.  
   - Body: `prompt`, optional `seriesId`, `chapterId`.

2. **POST `/ai/writing/outline`**  
   Generate outline for series, arc, or chapter.

3. **POST `/ai/writing/expand`**  
   Expand text into richer description or longer passage.

4. **POST `/ai/writing/dialogue`**  
   Generate dialogue based on context and characters.

5. **POST `/ai/writing/describe`**  
   Generate descriptive prose for scenes/characters.

6. **POST `/ai/writing/edit`**  
   Improve or rephrase existing text.

7. **POST `/ai/writing/proofread`**  
   Fix grammar/spelling.

8. **POST `/ai/writing/summarize`**  
   Summarize longer text.

9. **POST `/ai/writing/title`**  
   Suggest titles.

10. **POST `/ai/writing/blurb`**  
    Suggest blurbs/descriptions.

11. **POST `/ai/writing/custom`** (optional)  
    General-purpose AI call with `sessionType = CUSTOM`.

12. **GET `/ai/writing/sessions`**  
    List AI writing sessions for current user (with filters by type, date).

13. **GET `/ai/writing/sessions/{id}`**  
    Get specific session (prompt/response + metadata).

14. **POST `/ai/writing/sessions/{id}/feedback`**  
    Submit feedback (wasHelpful, helpfulRating, free-text feedback).

### 6.2 AI Translation (Generic) (4 endpoints)

15. **POST `/ai/translate`**  
    Translate arbitrary text (one-off).  
    - Body: `sourceText`, `sourceLanguage?`, `targetLanguage`.

16. **POST `/ai/translate/chapter`**  
    Translate chapter content for preview (not persisted).  
    - Body: `chapterId`, `targetLanguage`.

17. **POST `/ai/translate/detect`**  
    Detect language of a text.  
    - Body: `text`; returns `languageCode`, `confidence`.

18. **GET `/ai/translate/languages`**  
    List supported languages by AI translation provider.

### 6.3 AI Cover Generation (3 endpoints)

19. **POST `/ai/cover/generate`**  
    Generate cover concepts based on prompt, genre, style, etc.

20. **GET `/ai/cover/styles`**  
    List available cover styles (e.g., “anime”, “semi-realistic”, “painterly”).

21. **POST `/ai/cover/variations`**  
    Generate variations on an existing cover prompt or image.

### 6.4 TikTok Previews (6 endpoints)

22. **GET `/chapters/{chapterId}/tiktok-preview`**  
    Get current TikTok preview (if exists) for chapter.

23. **POST `/chapters/{chapterId}/tiktok-preview`**  
    Generate a new TikTok preview.  
    - Body: template selection, text snippet, background, audio preferences.

24. **PUT `/chapters/{chapterId}/tiktok-preview`**  
    Update metadata (e.g., style, text overlay) without re-generating video.

25. **DELETE `/chapters/{chapterId}/tiktok-preview`**  
    Delete preview and any associated references.

26. **POST `/chapters/{chapterId}/tiktok-preview/publish`**  
    Publish preview to TikTok/Instagram/YouTube Shorts via integration.

27. **GET `/ai/tiktok/templates`**  
    List available `TikTokTemplate` configurations (filter by `contentType`).

### 6.5 OCR & Comic Text Replacement (~6–7 endpoints)

28. **POST `/ai/ocr/extract`**  
    Start OCR job for a chapter image (or entire chapter).  
    - Body: `chapterImageId` or `chapterId`, `languageHint?`.

29. **GET `/ai/ocr/jobs/{id}`**  
    Get status of OCR job (PENDING/PROCESSING/COMPLETED/FAILED), with extracted text if done.

30. **POST `/ai/ocr/translate`**  
    Translate OCR-extracted text for a given image or region.  
    - Body: `chapterImageId`, `language`, `text?`.

31. **POST `/ai/ocr/replace`**  
    Create a `ComicTextReplacement` record (with original/translated text & bounding box).  
    - Body: `chapterImageId`, `language`, `originalText`, `originalBounds`, `translatedText`, `replacementStyle`.

32. **GET `/chapters/{chapterId}/text-replacements`**  
    List all text replacements for all images in chapter (optionally filtered by language).

33. **PUT `/chapters/{chapterId}/text-replacements/{id}`**  
    Update a replacement (e.g., change translated text or style; mark `isManualEdit`).

34. **DELETE `/chapters/{chapterId}/text-replacements/{id}`** (optional)  
    Delete a replacement entry.

### 6.6 AI Usage (3 endpoints)

35. **GET `/ai/usage`**  
    Get current period AI usage for logged-in user (words/tokens/covers/tiktoks used and limits).

36. **GET `/ai/usage/history`**  
    List past `AIUsageRecord` periods (for billing or analytics).

37. **GET `/ai/limits`**  
    Get current AI limits by platform tier (and possibly site tier for site-specific features).

> Optionally, an admin-level AI usage analytics endpoint can bring this closer to 38 (e.g., `GET /admin/ai/usage`), but the above set is already ~37–38 endpoints.

---

## 7. Integration With Other Modules

- **Author & Site Management / TierLimits:**
  - `AIUsageRecord` uses per-user limits sourced from `TierLimits` based on `AuthorAccount.platformTier`.
  - Free tiers may have very small AI quotas; higher tiers larger.

- **Content Management & Translations:**
  - Editor uses AI writing to generate content directly into chapters.
  - Translation module uses `ai-translation.service` + glossary to generate `SeriesTranslation` and `ChapterTranslation`.

- **Media & Files:**
  - AI cover and TikTok preview outputs are stored via `MediaFile` and storage providers (S3, R2, etc.).

- **Scheduling & Jobs:**
  - TikTok preview generation, OCR, heavy AI operations often run in JobQueue to avoid blocking HTTP requests.

- **Analytics:**
  - AI usage is tracked not just in `AIUsageRecord` but also via `AnalyticsEvent` (e.g., `AI_WRITING_SESSION_CREATED` if you define such).

- **Payments / Monetization:**
  - Excess AI usage (`overageCharged > 0`) can link to billing or add-on purchases.

---

Next, if you’re ready, I can document:

**Media & Files (22 endpoints)** – including:

- MediaFile upload and management
- StorageUsage tracking
- Image optimization, security scanning
- Integration with sites and content.