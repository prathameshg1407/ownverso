
# Author & Site Management – Technical Documentation

## 1. Purpose & Scope

The **Author & Site Management** module covers:

- Upgrading a user to **author** and managing their **AuthorAccount** (pen name, bio, verification)
- Managing the **author’s platform subscription** to Ownverso (platformTier, limited scope here; full billing logic in “Monetization – Subscriptions”)
- Managing **sites** (storefronts) owned by an author:
  - Site creation, update, deletion
  - Branding & theme
  - Custom domains & SSL
  - Static pages
  - Collaborators and their roles

This module is central for all author-side features and for public site rendering.

---

## 2. Prisma Schema (Models & Enums)

### 2.1 Relevant Enums

```prisma
enum PlatformTier {
  FREE
  STARTER
  GROWTH
  PROFESSIONAL
  ENTERPRISE
}

enum PlatformSubscriptionStatus {
  ACTIVE
  TRIALING
  PAST_DUE
  CANCELLED
  SUSPENDED
  EXPIRED
}

enum SiteStatus {
  DRAFT
  ACTIVE
  MAINTENANCE
  SUSPENDED
  DELETED
}

enum ContentRating {
  EVERYONE
  TEEN
  MATURE
  ADULT_ONLY
}

enum CollaboratorRole {
  VIEWER
  EDITOR
  TRANSLATOR
  ANALYST
  MANAGER
  OWNER
}

enum CommentModerationMode {
  NONE
  PRE_APPROVE
  POST_APPROVE
  TRUSTED_ONLY
}
```

### 2.2 Core Models

#### 2.2.1 `AuthorAccount`

Extends `User` with author-specific fields and platform subscription to Ownverso.

```prisma
model AuthorAccount {
  userId BigInt @id

  // Identity
  penName String?
  tagline String? @db.VarChar(200)
  fullBio String? @db.Text

  // Verification
  isVerified       Boolean   @default(false)
  verifiedAt       DateTime?
  verificationNote String?

  // Platform subscription to Ownverso
  platformTier           PlatformTier               @default(FREE)
  platformTierStatus     PlatformSubscriptionStatus @default(ACTIVE)
  platformTierStartedAt  DateTime?
  platformTierExpiresAt  DateTime?
  platformBillingCycle   BillingCycle?
  platformTrialEndsAt    DateTime?

  stripeCustomerId   String?
  razorpayCustomerId String?
  xenditCustomerId   String?

  // Usage/limits (cached)
  currentMonthRevenue   BigInt   @default(0)
  currentMonthUsageFee  BigInt   @default(0)
  currentMonthCurrency  String   @default("INR") @db.Char(3)
  lastUsageFeeInvoiceAt DateTime?

  seriesCount           Int    @default(0) @db.SmallInt
  totalChapterCount     Int    @default(0)
  activeSubscriberCount Int    @default(0)
  storageUsedBytes      BigInt @default(0)
  bandwidthUsedBytes    BigInt @default(0)
  emailBroadcastsThisMonth Int @default(0) @db.SmallInt

  // AI usage (monthly)
  aiTranslationWordsUsed Int       @default(0)
  aiWritingTokensUsed    Int       @default(0)
  aiCoverGenerationsUsed Int       @default(0) @db.SmallInt
  aiUsageResetAt         DateTime  @default(now())

  // Referral
  referralCode         String? @unique
  referralRewardMonths Int     @default(0) @db.SmallInt

  // Commissions (public page)
  acceptingCommissions Boolean @default(false)
  commissionInfo       String? @db.Text
  commissionMinPrice   Int?
  commissionMaxPrice   Int?
  commissionCurrency   String  @default("INR") @db.Char(3)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user                 User                    @relation(fields: [userId], references: [id], onDelete: Cascade)
  paymentGatewayConfig PaymentGatewayConfig?
  platformInvoices     PlatformInvoice[]
  authorPayouts        AuthorPayout[]
  tiersCreated         AuthorSubscriptionTier[]
  products             Product[]
  discountCodes        DiscountCode[]

  @@index([platformTier, platformTierStatus])
  @@index([referralCode])

  @@map("author_accounts")
}
```

#### 2.2.2 `Site`

Author’s storefront (for series, subscriptions, products).

```prisma
model Site {
  id       String @id @default(cuid())
  authorId BigInt

  slug        String     @unique
  name        String     @db.VarChar(100)
  tagline     String?    @db.VarChar(200)
  description String?    @db.Text
  status      SiteStatus @default(DRAFT)

  // Branding
  logoUrl       String? @db.VarChar(2048)
  faviconUrl    String? @db.VarChar(2048)
  coverImageUrl String? @db.VarChar(2048)

  // Theme
  themeId          String?
  primaryColor     String? @db.Char(7)
  secondaryColor   String? @db.Char(7)
  accentColor      String? @db.Char(7)
  customCss        String? @db.Text
  customCssEnabled Boolean @default(false)

  // Custom domain
  customDomain           String?   @unique @db.VarChar(253)
  customDomainVerified   Boolean   @default(false)
  customDomainVerifiedAt DateTime?
  customDomainDnsRecords Json?
  sslEnabled             Boolean   @default(true)
  sslExpiresAt           DateTime?

  // Visibility & status
  isPublic           Boolean   @default(true)
  maintenanceMode    Boolean   @default(false)
  maintenanceMessage String?   @db.Text
  suspensionReason   String?
  suspendedAt        DateTime?

  // SEO
  metaTitle       String? @db.VarChar(60)
  metaDescription String? @db.VarChar(160)
  ogImageUrl      String? @db.VarChar(2048)

  // Analytics
  googleAnalyticsId String?
  analyticsEnabled  Boolean @default(true)

  // Content settings
  defaultContentRating   ContentRating        @default(EVERYONE)
  commentsEnabled        Boolean              @default(true)
  commentsModerationMode CommentModerationMode @default(POST_APPROVE)

  lastPublishedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  author            User                    @relation(fields: [authorId], references: [id], onDelete: Cascade)
  theme             Theme?                  @relation(fields: [themeId], references: [id], onDelete: SetNull)
  series            Series[]
  pages             Page[]
  announcements     Announcement[]
  collaborators     Collaborator[]
  subscriptionTiers AuthorSubscriptionTier[]
  discountCodes     DiscountCode[]
  products          Product[]
  outgoingWebhooks  OutgoingWebhook[]
  socialConnections SocialConnection[]
  apiKeys           APIKey[]
  mediaFiles        MediaFile[]
  calendarEntries   ContentCalendarEntry[]
  importJobs        ImportJob[]
  exportJobs        ExportJob[]
  abTests           ABTest[]

  @@unique([authorId, slug])
  @@index([authorId])
  @@index([slug])
  @@index([customDomain])
  @@index([status, isPublic])

  @@map("sites")
}
```

#### 2.2.3 `Page` (static site pages)

```prisma
model Page {
  id     String @id @default(cuid())
  siteId String

  slug        String  @db.VarChar(100)
  title       String  @db.VarChar(100)
  content     String  @db.Text
  contentHtml String? @db.Text

  isPublished Boolean   @default(false)
  publishedAt DateTime?

  showInNav Boolean @default(false)
  navOrder  Int     @default(0) @db.SmallInt
  navLabel  String? @db.VarChar(30)

  metaTitle       String? @db.VarChar(60)
  metaDescription String? @db.VarChar(160)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  site Site @relation(fields: [siteId], references: [id], onDelete: Cascade)

  @@unique([siteId, slug])
  @@index([siteId, isPublished, navOrder])

  @@map("pages")
}
```

#### 2.2.4 `Theme` (site themes)

```prisma
model Theme {
  id          String  @id @default(cuid())
  name        String
  slug        String  @unique
  description String? @db.Text

  thumbnailUrl String? @db.VarChar(2048)
  previewUrl   String? @db.VarChar(2048)

  styles        Json
  colorSchemes  Json?
  fontOptions   Json?
  layoutOptions Json?

  isPublic     Boolean       @default(true)
  isPremium    Boolean       @default(false)
  requiredTier PlatformTier?

  usageCount Int @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  sites Site[]

  @@index([slug])
  @@index([isPublic, isPremium])

  @@map("themes")
}
```

#### 2.2.5 `Collaborator`

```prisma
model Collaborator {
  id     BigInt @id @default(autoincrement())
  siteId String
  userId BigInt

  role        CollaboratorRole
  permissions Json             @default("{}") // fine-grained permissions

  invitedByEmail String?
  inviteToken    String?   @unique
  invitedAt      DateTime  @default(now())
  acceptedAt     DateTime?
  expiresAt      DateTime?

  isActive          Boolean   @default(true)
  deactivatedAt     DateTime?
  deactivatedReason String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  site Site @relation(fields: [siteId], references: [id], onDelete: Cascade)
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([siteId, userId])
  @@index([siteId, isActive])

  @@map("collaborators")
}
```

These models + enums fully support author and site management functionality.

---

## 3. Backend Implementation

### 3.1 Route & Handler Structure

We split routes by **author** and **sites**.

#### 3.1.1 Author Routes – `src/api/v1/author/`

```text
src/api/v1/author/
  index.ts                      # Registers /author/* routes
  author.controller.ts
  author.service.ts
  author.schema.ts
  author.test.ts

  handlers/
    register-author.handler.ts        # POST /author/register
    get-account.handler.ts            # GET /author/account
    update-account.handler.ts         # PUT /author/account
    get-dashboard.handler.ts          # GET /author/dashboard
    get-stats.handler.ts              # GET /author/stats

    platform-subscription/
      get-subscription.handler.ts     # GET /author/platform-subscription
      list-plans.handler.ts           # GET /author/platform-plans
      subscribe.handler.ts            # POST /author/platform-subscription/subscribe
      change-plan.handler.ts          # PUT /author/platform-subscription/change
      cancel.handler.ts               # POST /author/platform-subscription/cancel
      reactivate.handler.ts           # POST /author/platform-subscription/reactivate
      list-invoices.handler.ts        # GET /author/platform-subscription/invoices
      get-invoice.handler.ts          # GET /author/platform-subscription/invoices/{id}
```

#### 3.1.2 Site Routes – `src/api/v1/sites/`

```text
src/api/v1/sites/
  index.ts                      # Registers /sites and nested routes
  sites.controller.ts
  sites.service.ts
  sites.schema.ts
  sites.test.ts

  handlers/
    list-sites.handler.ts               # GET /sites
    create-site.handler.ts              # POST /sites
    get-site.handler.ts                 # GET /sites/{siteId}
    update-site.handler.ts              # PUT /sites/{siteId}
    delete-site.handler.ts              # DELETE /sites/{siteId}
    get-site-stats.handler.ts           # GET /sites/{siteId}/stats
    get-site-overview.handler.ts        # GET /sites/{siteId}/overview

    settings/
      get-settings.handler.ts           # GET /sites/{siteId}/settings
      update-general.handler.ts         # PUT /sites/{siteId}/settings/general
      update-branding.handler.ts        # PUT /sites/{siteId}/settings/branding
      update-theme.handler.ts           # PUT /sites/{siteId}/settings/theme
      update-seo.handler.ts             # PUT /sites/{siteId}/settings/seo
      update-analytics.handler.ts       # PUT /sites/{siteId}/settings/analytics
      update-comments.handler.ts        # PUT /sites/{siteId}/settings/comments

    domain/
      get-domain.handler.ts             # GET /sites/{siteId}/domain
      add-domain.handler.ts             # POST /sites/{siteId}/domain
      verify-domain.handler.ts          # POST /sites/{siteId}/domain/verify
      remove-domain.handler.ts          # DELETE /sites/{siteId}/domain
      get-dns-records.handler.ts        # GET /sites/{siteId}/domain/dns-records
      provision-ssl.handler.ts          # POST /sites/{siteId}/domain/ssl/provision

    pages/
      list-pages.handler.ts             # GET /sites/{siteId}/pages
      create-page.handler.ts            # POST /sites/{siteId}/pages
      get-page.handler.ts               # GET /sites/{siteId}/pages/{pageId}
      update-page.handler.ts            # PUT /sites/{siteId}/pages/{pageId}
      delete-page.handler.ts            # DELETE /sites/{siteId}/pages/{pageId}
      reorder-pages.handler.ts          # PUT /sites/{siteId}/pages/reorder

    collaborators/
      list-collaborators.handler.ts     # GET /sites/{siteId}/collaborators
      invite-collaborator.handler.ts    # POST /sites/{siteId}/collaborators/invite
      get-collaborator.handler.ts       # GET /sites/{siteId}/collaborators/{id}
      update-collaborator.handler.ts    # PUT /sites/{siteId}/collaborators/{id}
      remove-collaborator.handler.ts    # DELETE /sites/{siteId}/collaborators/{id}
```

#### 3.1.3 Collaborator Flow Helpers

```text
src/api/v1/collaborator/
  index.ts
  accept-invite.handler.ts          # POST /collaborator/accept/{token}
  list-sites.handler.ts             # GET /collaborator/sites
```

#### 3.1.4 Themes – Catalog

```text
src/api/v1/themes/
  index.ts
  list-themes.handler.ts            # GET /themes
  get-theme.handler.ts              # GET /themes/{id}
  preview-theme.handler.ts          # GET /themes/{id}/preview (optional)
```

#### 3.1.5 Admin – Authors & Sites

```text
src/api/v1/admin/
  authors/
    list-authors.handler.ts         # GET /admin/authors
    get-author.handler.ts           # GET /admin/authors/{userId}
    verify-author.handler.ts        # PUT /admin/authors/{userId}/verify
    update-platform-tier.handler.ts # PUT /admin/authors/{userId}/platform-tier

  sites/
    list-sites.handler.ts           # GET /admin/sites
    get-site.handler.ts             # GET /admin/sites/{siteId}
    update-site-status.handler.ts   # PUT /admin/sites/{siteId}/status
```

### 3.2 Domain Layer

**Authors:** `src/domain/authors/`

```text
src/domain/authors/
  entities/
    author-account.entity.ts
  repositories/
    author-account.repository.ts
  services/
    author.service.ts               # get/upgrade author account, dashboard data
    author-platform-sub.service.ts  # platform subscription logic (create, change, cancel)
    author-stats.service.ts         # aggregates: series count, revenue summary
```

**Sites:** `src/domain/sites/`

```text
src/domain/sites/
  entities/
    site.entity.ts
    page.entity.ts
    theme.entity.ts
    collaborator.entity.ts

  repositories/
    site.repository.ts
    page.repository.ts
    theme.repository.ts
    collaborator.repository.ts

  services/
    site.service.ts                 # CRUD for site
    site-settings.service.ts        # handles settings updates
    site-domain.service.ts          # custom domain + DNS + SSL coordination
    page.service.ts                 # static pages CRUD
    collaborator.service.ts         # collaborator lifecycle & permissions
    theme.service.ts                # theme assignment + customization
    site-stats.service.ts           # aggregated site stats
```

Supporting infrastructure:

- `src/infrastructure/dns/` – DNS providers (Cloudflare, Route53)
- `src/infrastructure/ssl/` – SSL provisioning (Let’s Encrypt, Cloudflare)
- `src/infrastructure/storage/` – for logo, favicon, cover images.

---

## 4. Frontend Implementation (Next.js)

### 4.1 Author Dashboard Routes

Group: `src/app/(author)/`

```text
src/app/(author)/
  layout.tsx                       # Common author dashboard layout

  dashboard/
    page.tsx                       # /dashboard (author main)
    loading.tsx
    _components/
      stats-overview.tsx
      revenue-chart.tsx
      subscriber-chart.tsx
      recent-activity.tsx
      quick-actions.tsx
      upcoming-schedule.tsx

  sites/
    page.tsx                       # /sites (list)
    create/
      page.tsx                     # /sites/create
    [siteId]/
      page.tsx                     # /sites/{siteId} overview
      settings/
        page.tsx                   # /sites/{siteId}/settings
        general/
          page.tsx
        branding/
          page.tsx
        theme/
          page.tsx
        domain/
          page.tsx
        seo/
          page.tsx
        analytics/
          page.tsx
        comments/
          page.tsx
        danger/
          page.tsx
      pages/
        page.tsx                   # static pages list
        create/
          page.tsx
        [pageId]/
          edit/
            page.tsx
      collaborators/
        page.tsx

      _components/
        site-header.tsx
        site-nav.tsx
        site-settings-form.tsx
        branding-form.tsx
        theme-selector.tsx
        domain-settings.tsx
        collaborator-list.tsx
        invite-collaborator-modal.tsx
```

### 4.2 Site Public Routes

Group: `src/app/(site)/s/[siteSlug]/`

```text
src/app/(site)/s/[siteSlug]/
  page.tsx                         # Site homepage
  loading.tsx

  series/
    [seriesSlug]/
      page.tsx                     # Series public page

  page/
    [pageSlug]/
      page.tsx                     # Static pages

  announcements/
    page.tsx
    [slug]/
      page.tsx

  subscribe/
    page.tsx

  shop/
    page.tsx
    [productSlug]/
      page.tsx

  _components/
    site-header.tsx
    site-footer.tsx
    site-navigation.tsx
    site-hero.tsx
    series-grid.tsx
    subscription-cta.tsx
```

### 4.3 Components

Common author components:

```text
src/components/dashboard/
  dashboard-layout.tsx
  dashboard-header.tsx
  dashboard-sidebar.tsx
  nav-item.tsx
  nav-group.tsx

src/components/sites/
  site-card.tsx
  site-list.tsx
  site-status-badge.tsx
  site-stats-cards.tsx
  site-form.tsx
  site-domain-form.tsx
  site-branding-preview.tsx

src/components/pages/
  page-list.tsx
  page-editor.tsx

src/components/collaborators/
  collaborator-card.tsx
  collaborator-role-badge.tsx
  collaborator-permissions-form.tsx
  collaborator-invite-form.tsx
```

### 4.4 Hooks

```text
src/hooks/
  use-author-account.ts           # GET /author/account, update account
  use-author-dashboard.ts         # GET /author/dashboard
  use-author-stats.ts             # GET /author/stats
  use-platform-subscription.ts    # Platform subscription details

  use-sites.ts                    # list/create sites
  use-site-detail.ts              # get/update single site
  use-site-settings.ts            # get/update settings
  use-site-domain.ts              # domain ops
  use-site-pages.ts               # pages CRUD
  use-site-collaborators.ts       # collaborator CRUD
```

### 4.5 API Client Endpoints

```text
src/lib/api/endpoints/author.ts

export const authorApi = {
  registerAuthor: () => api.post('/author/register'),
  getAccount: () => api.get('/author/account'),
  updateAccount: (data: UpdateAuthorAccountDto) =>
    api.put('/author/account', data),
  getDashboard: () => api.get('/author/dashboard'),
  getStats: () => api.get('/author/stats'),

  getPlatformSubscription: () => api.get('/author/platform-subscription'),
  listPlatformPlans: () => api.get('/author/platform-plans'),
  subscribePlatform: (data: SubscribePlatformDto) =>
    api.post('/author/platform-subscription/subscribe', data),
  changePlatformPlan: (data: ChangePlatformPlanDto) =>
    api.put('/author/platform-subscription/change', data),
  cancelPlatformSubscription: () =>
    api.post('/author/platform-subscription/cancel', {}),
  reactivatePlatformSubscription: () =>
    api.post('/author/platform-subscription/reactivate', {}),
  listPlatformInvoices: () =>
    api.get('/author/platform-subscription/invoices'),
  getPlatformInvoice: (id: string) =>
    api.get(`/author/platform-subscription/invoices/${id}`),
};
```

```text
src/lib/api/endpoints/sites.ts

export const sitesApi = {
  listSites: () => api.get('/sites'),
  createSite: (data: CreateSiteDto) => api.post('/sites', data),
  getSite: (siteId: string) => api.get(`/sites/${siteId}`),
  updateSite: (siteId: string, data: UpdateSiteDto) =>
    api.put(`/sites/${siteId}`, data),
  deleteSite: (siteId: string) => api.delete(`/sites/${siteId}`),
  getSiteStats: (siteId: string) => api.get(`/sites/${siteId}/stats`),
  getSiteOverview: (siteId: string) => api.get(`/sites/${siteId}/overview`),

  getSettings: (siteId: string) => api.get(`/sites/${siteId}/settings`),
  updateGeneral: (siteId: string, data: UpdateSiteGeneralDto) =>
    api.put(`/sites/${siteId}/settings/general`, data),
  updateBranding: (siteId: string, data: UpdateSiteBrandingDto) =>
    api.put(`/sites/${siteId}/settings/branding`, data),
  updateThemeSettings: (siteId: string, data: UpdateSiteThemeDto) =>
    api.put(`/sites/${siteId}/settings/theme`, data),
  updateSeo: (siteId: string, data: UpdateSiteSeoDto) =>
    api.put(`/sites/${siteId}/settings/seo`, data),
  updateAnalyticsSettings: (siteId: string, data: UpdateSiteAnalyticsDto) =>
    api.put(`/sites/${siteId}/settings/analytics`, data),
  updateCommentsSettings: (siteId: string, data: UpdateSiteCommentsDto) =>
    api.put(`/sites/${siteId}/settings/comments`, data),

  getDomain: (siteId: string) => api.get(`/sites/${siteId}/domain`),
  addDomain: (siteId: string, data: AddDomainDto) =>
    api.post(`/sites/${siteId}/domain`, data),
  verifyDomain: (siteId: string) =>
    api.post(`/sites/${siteId}/domain/verify`, {}),
  removeDomain: (siteId: string) =>
    api.delete(`/sites/${siteId}/domain`),
  getDnsRecords: (siteId: string) =>
    api.get(`/sites/${siteId}/domain/dns-records`),
  provisionSsl: (siteId: string) =>
    api.post(`/sites/${siteId}/domain/ssl/provision`, {}),

  listPages: (siteId: string) => api.get(`/sites/${siteId}/pages`),
  createPage: (siteId: string, data: CreatePageDto) =>
    api.post(`/sites/${siteId}/pages`, data),
  getPage: (siteId: string, pageId: string) =>
    api.get(`/sites/${siteId}/pages/${pageId}`),
  updatePage: (siteId: string, pageId: string, data: UpdatePageDto) =>
    api.put(`/sites/${siteId}/pages/${pageId}`, data),
  deletePage: (siteId: string, pageId: string) =>
    api.delete(`/sites/${siteId}/pages/${pageId}`),
  reorderPages: (siteId: string, data: ReorderPagesDto) =>
    api.put(`/sites/${siteId}/pages/reorder`, data),

  listCollaborators: (siteId: string) =>
    api.get(`/sites/${siteId}/collaborators`),
  inviteCollaborator: (siteId: string, data: InviteCollaboratorDto) =>
    api.post(`/sites/${siteId}/collaborators/invite`, data),
  getCollaborator: (siteId: string, id: number) =>
    api.get(`/sites/${siteId}/collaborators/${id}`),
  updateCollaborator: (siteId: string, id: number, data: UpdateCollaboratorDto) =>
    api.put(`/sites/${siteId}/collaborators/${id}`, data),
  removeCollaborator: (siteId: string, id: number) =>
    api.delete(`/sites/${siteId}/collaborators/${id}`),

  // Helper routes
  acceptInvite: (token: string) =>
    api.post(`/collaborator/accept/${token}`, {}),
  listCollaboratorSites: () => api.get('/collaborator/sites'),
};
```

Admin endpoints live in `endpoints/admin.ts`.

---

## 5. API Reference – Author & Site Management (58 endpoints)

Base URL: `https://api.ownverso.com/v1`

### 5.1 Author Account (Core)

#### 1. `POST /author/register`

- **Description:** Upgrade current user to author (creates `AuthorAccount`).
- **Auth:** User
- **Body (optional, for initial setup):**
  - `penName?: string`
  - `tagline?: string`
  - `fullBio?: string`
- **Response (201):**
  - `authorAccount` object with `platformTier`, `isVerified`, etc.

#### 2. `GET /author/account`

- **Description:** Get current author account details. If user is not an author, 404 or 403 depending on design.
- **Auth:** Author
- **Response (200):**
  - `penName`, `tagline`, `fullBio`
  - `isVerified`, `verifiedAt`
  - `platformTier`, `platformTierStatus`, `platformTrialEndsAt`
  - aggregated stats (seriesCount, activeSubscriberCount, etc.)

#### 3. `PUT /author/account`

- **Description:** Update author profile details.
- **Auth:** Author
- **Body:**
  - `penName?`, `tagline?`, `fullBio?`, `acceptingCommissions?`, `commissionInfo?`, etc.
- **Response (200):** Updated author account.

#### 4. `GET /author/dashboard`

- **Description:** Summary for author home dashboard.
- **Auth:** Author
- **Response (200):** includes:
  - revenue summary
  - subscriber summary
  - recent series updates
  - upcoming schedule
  - platform subscription status snippet

#### 5. `GET /author/stats`

- **Description:** Detailed author-level stats (aggregated across sites).
- **Auth:** Author

### 5.2 Author Platform Subscription (Ownverso)

*(Billing specifics belong in Monetization – Subscriptions, but we include the endpoints here for discoverability.)*

#### 6. `GET /author/platform-subscription`

- **Description:** Get author’s platform subscription to Ownverso.
- **Auth:** Author

#### 7. `GET /author/platform-plans`

- **Description:** List available platform tiers (FREE, STARTER, etc.).
- **Auth:** Author

#### 8. `POST /author/platform-subscription/subscribe`

- **Description:** Subscribe to a platform tier.
- **Auth:** Author
- **Body:**
  - `tier: PlatformTier`
  - `billingCycle: BillingCycle`
  - `paymentMethodId` / gateway-specific fields

#### 9. `PUT /author/platform-subscription/change`

- **Description:** Change platform tier (upgrade/downgrade).
- **Auth:** Author

#### 10. `POST /author/platform-subscription/cancel`

- **Description:** Cancel platform subscription (reverts to FREE at period end).
- **Auth:** Author

#### 11. `POST /author/platform-subscription/reactivate`

- **Description:** Reactivate platform subscription during grace period.
- **Auth:** Author

#### 12. `GET /author/platform-subscription/invoices`

- **Description:** List platform usage invoices (`PlatformInvoice`).
- **Auth:** Author

#### 13. `GET /author/platform-subscription/invoices/{id}`

- **Description:** Get specific invoice details.
- **Auth:** Author

### 5.3 Sites – Core CRUD

#### 14. `GET /sites`

- **Description:** List sites owned by current author.
- **Auth:** Author
- **Response:** array of site summaries.

#### 15. `POST /sites`

- **Description:** Create new site.
- **Auth:** Author
- **Body:**
  - `name` (string)
  - `slug` (string, unique per author)
  - optional: `description`, `tagline`
- **Response (201):** Created `Site`.

#### 16. `GET /sites/{siteId}`

- **Description:** Get full site details.
- **Auth:** Author or Collaborator (with proper permission).
- **Response (200):** `Site` + some computed fields (seriesCount, etc.).

#### 17. `PUT /sites/{siteId}`

- **Description:** Update core site fields (name, tagline, description).
- **Auth:** Author / MANAGER collaborator.

#### 18. `DELETE /sites/{siteId}`

- **Description:** Soft-delete site (`status = DELETED`).
- **Auth:** Author (OWNER/author only).

#### 19. `GET /sites/{siteId}/stats`

- **Description:** Aggregated site statistics (used in site overview).
- **Auth:** Author / appropriate collaborator.

#### 20. `GET /sites/{siteId}/overview`

- **Description:** Combined summary (stats + recent activity).
- **Auth:** Author / collaborator.

### 5.4 Site Settings

#### 21. `GET /sites/{siteId}/settings`

- **Description:** Get all site settings (branding, theme, SEO, comments).
- **Auth:** Author / MANAGER.

#### 22. `PUT /sites/{siteId}/settings/general`

- **Description:** Update general settings.
- **Body:** `name`, `slug`, `description`, `tagline`, `status` (DRAFT/ACTIVE/MAINTENANCE).

#### 23. `PUT /sites/{siteId}/settings/branding`

- **Description:** Update branding (logoUrl, faviconUrl, colors).
- **Body:**
  - `logoUrl?`, `faviconUrl?`, `coverImageUrl?`
  - `primaryColor?`, `secondaryColor?`, `accentColor?`

#### 24. `PUT /sites/{siteId}/settings/theme`

- **Description:** Update theme-related settings (themeId, customCssEnabled).
- **Body:**
  - `themeId?`
  - `customCssEnabled?`
  - `customCss?`

#### 25. `PUT /sites/{siteId}/settings/seo`

- **Description:** Update SEO defaults.
- **Body:**
  - `metaTitle?`, `metaDescription?`, `ogImageUrl?`

#### 26. `PUT /sites/{siteId}/settings/analytics`

- **Description:** Update analytics settings.
- **Body:**
  - `googleAnalyticsId?`
  - `analyticsEnabled?`

#### 27. `PUT /sites/{siteId}/settings/comments`

- **Description:** Update comment settings.
- **Body:**
  - `commentsEnabled?`
  - `commentsModerationMode?` (`NONE`, `PRE_APPROVE`, `POST_APPROVE`, `TRUSTED_ONLY`)

### 5.5 Themes

#### 28. `GET /themes`

- **Description:** List available themes (public & allowed by tier).
- **Auth:** Author
- **Query:**
  - `isPublic?`, `isPremium?`

#### 29. `GET /themes/{themeId}`

- **Description:** Get theme details (preview).
- **Auth:** Author

#### 30. `POST /sites/{siteId}/theme/apply`

- **Description:** Apply a theme to a site.
- **Auth:** Author / MANAGER
- **Body:** `themeId`

#### 31. `PUT /sites/{siteId}/theme/customize`

- **Description:** Persist site-specific theme overrides (palette, fonts, etc.).
- **Auth:** Author / MANAGER

### 5.6 Custom Domains & SSL

#### 32. `GET /sites/{siteId}/domain`

- **Description:** Get custom domain config for a site.
- **Auth:** Author / MANAGER

#### 33. `POST /sites/{siteId}/domain`

- **Description:** Set custom domain.
- **Body:** `customDomain` (FQDN)

#### 34. `POST /sites/{siteId}/domain/verify`

- **Description:** Trigger DNS verification workflow.
- **Behavior:** Checks DNS via DNS provider; updates `customDomainVerified`.

#### 35. `DELETE /sites/{siteId}/domain`

- **Description:** Remove custom domain.

#### 36. `GET /sites/{siteId}/domain/dns-records`

- **Description:** Return DNS records that author must configure.
- **Auth:** Author / MANAGER

#### 37. `POST /sites/{siteId}/domain/ssl/provision`

- **Description:** Provision/renew SSL certificate.
- **Auth:** Author / MANAGER

### 5.7 Static Pages

#### 38. `GET /sites/{siteId}/pages`

- **Description:** List static pages for a site.
- **Auth:** Author / EDITOR / MANAGER

#### 39. `POST /sites/{siteId}/pages`

- **Description:** Create a new page.
- **Body:**
  - `slug`, `title`, `content` (markdown or HTML), `isPublished?`, `showInNav?`, `navLabel?`

#### 40. `GET /sites/{siteId}/pages/{pageId}`

- **Description:** Get page details.

#### 41. `PUT /sites/{siteId}/pages/{pageId}`

- **Description:** Update page.

#### 42. `DELETE /sites/{siteId}/pages/{pageId}`

- **Description:** Delete page.

#### 43. `PUT /sites/{siteId}/pages/reorder`

- **Description:** Reorder pages in navigation.
- **Body:**
  - `orders: { pageId: string; navOrder: number }[]`

### 5.8 Collaborators

#### 44. `GET /sites/{siteId}/collaborators`

- **Description:** List collaborators for a site (with roles & permissions).
- **Auth:** Author / MANAGER

#### 45. `POST /sites/{siteId}/collaborators/invite`

- **Description:** Invite a collaborator by email.
- **Body:**
  - `email`, `role`, `permissions?`
- **Behavior:** Creates `Collaborator` row with `inviteToken`, sends email.

#### 46. `GET /sites/{siteId}/collaborators/{id}`

- **Description:** Get a specific collaborator’s details.
- **Auth:** Author / MANAGER

#### 47. `PUT /sites/{siteId}/collaborators/{id}`

- **Description:** Update collaborator role/permissions.
- **Auth:** Author / MANAGER

#### 48. `DELETE /sites/{siteId}/collaborators/{id}`

- **Description:** Remove collaborator from site.
- **Auth:** Author / MANAGER

#### 49. `POST /collaborator/accept/{token}`

- **Description:** Accept site collaboration invite.
- **Auth:** User (must be logged in)
- **Behavior:** links `Collaborator.userId` to current user, sets `acceptedAt`.

#### 50. `GET /collaborator/sites`

- **Description:** List sites where current user is a collaborator.
- **Auth:** User

### 5.9 Admin – Authors & Sites

#### 51. `GET /admin/sites`

- **Description:** List sites across the platform (for admin).
- **Auth:** ADMIN / SUPER_ADMIN
- **Query:** `status?`, `authorId?`, `q?`, pagination.

#### 52. `GET /admin/sites/{siteId}`

- **Description:** Get detailed site info (admin view).

#### 53. `PUT /admin/sites/{siteId}/status`

- **Description:** Change site status (ACTIVE, SUSPENDED, etc.).
- **Auth:** ADMIN / SUPER_ADMIN
- **Body:**
  - `status: SiteStatus`
  - `reason?: string`

#### 54. `GET /admin/authors`

- **Description:** List all authors (`AuthorAccount` where exists).
- **Auth:** ADMIN / SUPER_ADMIN

#### 55. `GET /admin/authors/{userId}`

- **Description:** Detailed author account view (admin).

#### 56. `PUT /admin/authors/{userId}/verify`

- **Description:** Mark author as verified/unverified.
- **Auth:** ADMIN / SUPER_ADMIN
- **Body:** `isVerified: boolean`, `note?: string`

#### 57. `PUT /admin/authors/{userId}/platform-tier`

- **Description:** Force-change author’s platform tier (support edge cases).
- **Auth:** SUPER_ADMIN
- **Body:** `tier: PlatformTier`, `status?: PlatformSubscriptionStatus`, `reason?: string`

#### 58. (Optional) `GET /admin/sites/domains/pending`

- Collapse this into the total: e.g., list of sites with unverified domains; but you can also treat this as one of the 58 if desired.

---

## 6. Integration With Other Modules

- **Content Management:**
  - `Series` and `Chapter` always belong to a `Site`; site settings (defaultContentRating, comment policy) influence how series/chapters behave.

- **Monetization – Subscriptions:**
  - `AuthorSubscriptionTier` is tied to `Site` (per-site subscription configuration).
  - Author’s platform tier (`AuthorAccount.platformTier`) can restrict number of sites, series, storage, etc.

- **Media & Files:**
  - `MediaFile` references `siteId` for scoping files to a site.

- **Webhooks & Integrations:**
  - `OutgoingWebhook`, `SocialConnection`, `APIKey` are all scoped by `siteId`.

- **Platform Administration:**
  - Admin site & author lists, status toggles, and tier overrides use the models and endpoints in this module.

---

