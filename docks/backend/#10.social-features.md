

# Social Features – Technical Documentation

## 1. Purpose & Scope

The **Social Features** module covers:

- **Author follows**:
  - Readers follow authors
  - Notification preferences per follow

- **Comments & reactions**:
  - Comments on chapters (threaded replies)
  - Reactions (like/love/etc.) on chapters and comments

- **Reviews**:
  - Series reviews (rating + text)
  - Helpfulness votes
  - Author responses

- **Announcements**:
  - Site announcements created by authors
  - Publishing/pinning

- **Forum**:
  - Forum categories (hierarchical)
  - Posts and replies
  - Likes on posts

It integrates with:

- **Reader Engagement** (comments, reactions, reviews feed engagement metrics)
- **Notifications** (notify on new comments/replies/mentions/reviews)
- **Moderation** (reports, hiding/removing content)
- **Analytics** (events for comments, reactions, reviews, forum)

---

## 2. Prisma Schema (Models & Enums)

### 2.1 Relevant Enums

```prisma
enum ReactionType {
  LIKE
  LOVE
  LAUGH
  CRY
  ANGRY
  WOW
  SAD
  FIRE
  CELEBRATE
}

enum ReadingListType { // already defined but relevant
  WANT_TO_READ
  CURRENTLY_READING
  COMPLETED
  ON_HOLD
  DROPPED
  FAVORITES
  REREADING
  CUSTOM
}
```

No additional enums are strictly needed for this module.

### 2.2 Models

#### 2.2.1 `AuthorFollow`

```prisma
model AuthorFollow {
  followerId BigInt
  authorId   BigInt

  notifyNewSeries     Boolean @default(true)
  notifyNewChapters   Boolean @default(true)
  notifyAnnouncements Boolean @default(true)

  createdAt DateTime @default(now())

  follower User @relation("UserFollowing", fields: [followerId], references: [id], onDelete: Cascade)
  author   User @relation("UserFollowers", fields: [authorId], references: [id], onDelete: Cascade)

  @@id([followerId, authorId])
  @@index([authorId])

  @@map("author_follows")
}
```

#### 2.2.2 `Comment`

```prisma
model Comment {
  id        BigInt @id @default(autoincrement())
  userId    BigInt
  chapterId String

  parentId BigInt?
  depth    Int     @default(0) @db.SmallInt

  content     String  @db.Text
  contentHtml String? @db.Text
  hasSpoiler  Boolean @default(false)

  // Moderation
  isHidden     Boolean   @default(false)
  hiddenReason String?
  hiddenAt     DateTime?
  hiddenById   BigInt?

  isPinned   Boolean   @default(false)
  pinnedAt   DateTime?
  pinnedById BigInt?

  // Edit tracking
  isEdited  Boolean   @default(false)
  editedAt  DateTime?
  editCount Int       @default(0) @db.SmallInt

  // Soft delete
  deletedAt     DateTime?
  deletedBy     BigInt?
  deletedReason String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user      User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  chapter   Chapter    @relation(fields: [chapterId], references: [id], onDelete: Cascade)
  parent    Comment?   @relation("CommentReplies", fields: [parentId], references: [id], onDelete: Cascade)
  replies   Comment[]  @relation("CommentReplies")
  reactions Reaction[]

  @@index([chapterId, isHidden, deletedAt, createdAt(sort: Desc)])
  @@index([userId])
  @@index([parentId])

  @@map("comments")
}
```

#### 2.2.3 `Reaction`

```prisma
model Reaction {
  id BigInt @id @default(autoincrement())

  userId    BigInt
  chapterId String?
  commentId BigInt?

  type ReactionType

  createdAt DateTime @default(now())

  user    User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  chapter Chapter? @relation(fields: [chapterId], references: [id], onDelete: Cascade)
  comment Comment? @relation(fields: [commentId], references: [id], onDelete: Cascade)

  @@unique([userId, chapterId, type])
  @@unique([userId, commentId, type])
  @@index([chapterId, type])
  @@index([commentId, type])

  @@map("reactions")
}
```

#### 2.2.4 `Review`

```prisma
enum ReadingStatusType {
  NOT_STARTED
  READING
  COMPLETED
  ON_HOLD
  DROPPED
}

model Review {
  id       String @id @default(cuid())
  userId   BigInt
  seriesId String

  rating        Int     @db.SmallInt // 1-10
  title         String? @db.VarChar(100)
  content       String  @db.Text
  hasSpoilers   Boolean @default(false)
  readingStatus ReadingStatusType?

  chaptersReadAtReview Int     @default(0)
  isVerified           Boolean @default(false)
  // Verified: user has read enough OR is subscriber

  helpfulCount   Int @default(0)
  unhelpfulCount Int @default(0)

  authorResponse   String?   @db.Text
  authorResponseAt DateTime?

  // Moderation
  isHidden     Boolean   @default(false)
  hiddenReason String?
  hiddenAt     DateTime?
  hiddenById   BigInt?

  // Edit tracking
  isEdited  Boolean   @default(false)
  editedAt  DateTime?
  editCount Int       @default(0) @db.SmallInt

  // Soft delete
  deletedAt     DateTime?
  deletedBy     BigInt?
  deletedReason String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user   User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  series Series       @relation(fields: [seriesId], references: [id], onDelete: Cascade)
  votes  ReviewVote[]

  @@unique([userId, seriesId])
  @@index([seriesId, isHidden, deletedAt, rating(sort: Desc)])
  @@index([seriesId, isHidden, deletedAt, createdAt(sort: Desc)])

  @@map("reviews")
}
```

#### 2.2.5 `ReviewVote`

```prisma
model ReviewVote {
  reviewId  String
  userId    BigInt
  isHelpful Boolean

  createdAt DateTime @default(now())

  review Review @relation(fields: [reviewId], references: [id], onDelete: Cascade)
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([reviewId, userId])
  @@index([userId])

  @@map("review_votes")
}
```

#### 2.2.6 `Announcement`

```prisma
model Announcement {
  id     String @id @default(cuid())
  siteId String

  title       String  @db.VarChar(200)
  slug        String
  content     String  @db.Text
  contentHtml String? @db.Text
  excerpt     String? @db.VarChar(300)

  coverImageUrl String? @db.VarChar(2048)

  isPublished       Boolean   @default(false)
  publishedAt       DateTime?
  scheduledAt       DateTime?
  isPinned          Boolean   @default(false)
  showOnHomepage    Boolean   @default(true)
  notifySubscribers Boolean   @default(false)

  viewCount Int @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  site        Site         @relation(fields: [siteId], references: [id], onDelete: Cascade)
  socialPosts SocialPost[]

  @@unique([siteId, slug])
  @@index([siteId, isPublished, isPinned])
  @@index([scheduledAt])

  @@map("announcements")
}
```

#### 2.2.7 `ForumCategory`

```prisma
model ForumCategory {
  id String @id @default(cuid())

  name        String  @db.VarChar(100)
  slug        String  @unique
  description String? @db.Text
  iconUrl     String? @db.VarChar(2048)
  color       String? @db.Char(7)

  parentId String?

  displayOrder     Int      @default(0) @db.SmallInt
  isActive         Boolean  @default(true)
  isStaffOnly      Boolean  @default(false)
  requiresApproval Boolean  @default(false)
  moderatorIds     BigInt[] @default([])

  postCount Int @default(0)

  lastPostAt     DateTime?
  lastPostId     BigInt?
  lastPostUserId BigInt?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  parent   ForumCategory?  @relation("CategoryHierarchy", fields: [parentId], references: [id], onDelete: SetNull)
  children ForumCategory[] @relation("CategoryHierarchy")
  posts    ForumPost[]

  @@index([slug])
  @@index([isActive, displayOrder])

  @@map("forum_categories")
}
```

#### 2.2.8 `ForumPost`

```prisma
model ForumPost {
  id         BigInt @id @default(autoincrement())
  authorId   BigInt
  categoryId String

  title       String  @db.VarChar(200)
  slug        String
  content     String  @db.Text
  contentHtml String? @db.Text
  excerpt     String? @db.VarChar(300)

  parentId BigInt?
  depth    Int     @default(0) @db.SmallInt

  viewCount  Int @default(0)
  replyCount Int @default(0)
  likeCount  Int @default(0)

  isPinned   Boolean @default(false)
  isLocked   Boolean @default(false)
  isHidden   Boolean @default(false)
  isApproved Boolean @default(true)

  hiddenReason String?
  hiddenById   BigInt?
  hiddenAt     DateTime?

  lastActivityAt  DateTime @default(now())
  lastReplyId     BigInt?
  lastReplyUserId BigInt?

  isEdited  Boolean   @default(false)
  editedAt  DateTime?
  editCount Int       @default(0) @db.SmallInt

  // Soft delete
  deletedAt     DateTime?
  deletedBy     BigInt?
  deletedReason String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  author   User            @relation(fields: [authorId], references: [id], onDelete: Cascade)
  category ForumCategory   @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  parent   ForumPost?      @relation("ForumReplies", fields: [parentId], references: [id], onDelete: Cascade)
  replies  ForumPost[]     @relation("ForumReplies")
  likes    ForumPostLike[]

  @@unique([categoryId, slug])
  @@index([authorId])
  @@index([categoryId, isHidden, isApproved, deletedAt, isPinned(sort: Desc), lastActivityAt(sort: Desc)])
  @@index([parentId])

  @@map("forum_posts")
}
```

#### 2.2.9 `ForumPostLike`

```prisma
model ForumPostLike {
  postId BigInt
  userId BigInt

  createdAt DateTime @default(now())

  post ForumPost @relation(fields: [postId], references: [id], onDelete: Cascade)
  user User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([postId, userId])
  @@index([userId])

  @@map("forum_post_likes")
}
```

These models + `ReactionType` enum are the core for Social Features.

---

## 3. Backend Implementation

### 3.1 Route & Handler Structure

We group by:

- Follows
- Comments & Reactions
- Reviews
- Announcements
- Forum

#### 3.1.1 Author Follows – `src/api/v1/follows/`

```text
src/api/v1/follows/
  index.ts
  follows.controller.ts
  follows.service.ts
  follows.schema.ts
  follows.test.ts

  handlers/
    follow-author.handler.ts           # POST /authors/{authorId}/follow
    unfollow-author.handler.ts         # DELETE /authors/{authorId}/follow
    list-following.handler.ts          # GET /following
    list-followers.handler.ts          # GET /authors/{authorId}/followers
    update-follow-notifications.handler.ts # PUT /authors/{authorId}/follow/notifications
```

#### 3.1.2 Comments & Reactions – `src/api/v1/comments/` and `.../reactions/`

```text
src/api/v1/comments/
  index.ts
  comments.controller.ts
  comments.service.ts
  comments.schema.ts
  comments.test.ts

  handlers/
    list-chapter-comments.handler.ts       # GET /chapters/{chapterId}/comments
    create-comment.handler.ts              # POST /chapters/{chapterId}/comments
    get-comment.handler.ts                 # GET /comments/{id}
    update-comment.handler.ts              # PUT /comments/{id}
    delete-comment.handler.ts              # DELETE /comments/{id}
    list-replies.handler.ts                # GET /comments/{id}/replies
    create-reply.handler.ts                # POST /comments/{id}/replies
    pin-comment.handler.ts                 # POST /comments/{id}/pin (author)
    unpin-comment.handler.ts               # POST /comments/{id}/unpin
    hide-comment.handler.ts                # POST /comments/{id}/hide (author/mod)
    unhide-comment.handler.ts              # POST /comments/{id}/unhide
```

```text
src/api/v1/reactions/
  index.ts
  reactions.controller.ts
  reactions.service.ts
  reactions.schema.ts
  reactions.test.ts

  handlers/
    add-chapter-reaction.handler.ts        # POST /chapters/{chapterId}/reactions
    remove-chapter-reaction.handler.ts     # DELETE /chapters/{chapterId}/reactions/{type}
    list-chapter-reactions.handler.ts      # GET /chapters/{chapterId}/reactions

    add-comment-reaction.handler.ts        # POST /comments/{commentId}/reactions
    remove-comment-reaction.handler.ts     # DELETE /comments/{commentId}/reactions/{type}
    list-comment-reactions.handler.ts      # GET /comments/{commentId}/reactions
```

#### 3.1.3 Reviews – `src/api/v1/reviews/`

```text
src/api/v1/reviews/
  index.ts
  reviews.controller.ts
  reviews.service.ts
  reviews.schema.ts
  reviews.test.ts

  handlers/
    list-series-reviews.handler.ts         # GET /series/{seriesId}/reviews
    create-review.handler.ts               # POST /series/{seriesId}/reviews
    get-review.handler.ts                  # GET /reviews/{id}
    update-review.handler.ts               # PUT /reviews/{id}
    delete-review.handler.ts               # DELETE /reviews/{id}
    vote-review.handler.ts                 # POST /reviews/{id}/vote
    respond-to-review.handler.ts           # POST /reviews/{id}/response (author)
    list-my-reviews.handler.ts             # GET /reviews/mine
    list-author-reviews.handler.ts         # GET /author/reviews
```

#### 3.1.4 Announcements – `src/api/v1/announcements/`

```text
src/api/v1/announcements/
  index.ts
  announcements.controller.ts
  announcements.service.ts
  announcements.schema.ts
  announcements.test.ts

  handlers/
    list-announcements.handler.ts          # GET /sites/{siteId}/announcements
    create-announcement.handler.ts         # POST /sites/{siteId}/announcements
    get-announcement.handler.ts            # GET /sites/{siteId}/announcements/{id}
    update-announcement.handler.ts         # PUT /sites/{siteId}/announcements/{id}
    delete-announcement.handler.ts         # DELETE /sites/{siteId}/announcements/{id}
    publish-announcement.handler.ts        # POST /sites/{siteId}/announcements/{id}/publish
    unpublish-announcement.handler.ts      # POST /sites/{siteId}/announcements/{id}/unpublish
    pin-announcement.handler.ts            # POST /sites/{siteId}/announcements/{id}/pin
    unpin-announcement.handler.ts          # POST /sites/{siteId}/announcements/{id}/unpin
```

Public announcements are also accessible via `/s/{siteSlug}/announcements` (documented in Public/Discovery).

#### 3.1.5 Forum – `src/api/v1/forum/`

```text
src/api/v1/forum/
  index.ts
  forum.controller.ts
  forum.service.ts
  forum.schema.ts
  forum.test.ts

  handlers/
    categories/
      list-categories.handler.ts          # GET /forum/categories
      get-category.handler.ts             # GET /forum/categories/{slug}
      admin-create-category.handler.ts    # POST /admin/forum/categories
      admin-update-category.handler.ts    # PUT /admin/forum/categories/{id}
      admin-delete-category.handler.ts    # DELETE /admin/forum/categories/{id}

    posts/
      list-posts.handler.ts               # GET /forum/categories/{slug}/posts
      create-post.handler.ts              # POST /forum/posts
      get-post.handler.ts                 # GET /forum/posts/{id}
      update-post.handler.ts              # PUT /forum/posts/{id}
      delete-post.handler.ts              # DELETE /forum/posts/{id}
      reply-to-post.handler.ts            # POST /forum/posts/{id}/reply
      like-post.handler.ts                # POST /forum/posts/{id}/like
      unlike-post.handler.ts              # DELETE /forum/posts/{id}/like
      search-forum.handler.ts             # GET /forum/search
      pin-post.handler.ts                 # POST /forum/posts/{id}/pin (mod)
      lock-post.handler.ts                # POST /forum/posts/{id}/lock (mod)
      hide-post.handler.ts                # POST /forum/posts/{id}/hide (mod)
      unhide-post.handler.ts              # POST /forum/posts/{id}/unhide (mod)
```

Moderation actions will also be referenced in Moderation module.

### 3.2 Domain Layer

**Module:** `src/domain/social/`

```text
src/domain/social/
  entities/
    author-follow.entity.ts
    comment.entity.ts
    reaction.entity.ts
    review.entity.ts
    review-vote.entity.ts
    forum-category.entity.ts
    forum-post.entity.ts
    forum-post-like.entity.ts
    announcement.entity.ts

  repositories/
    author-follow.repository.ts
    comment.repository.ts
    reaction.repository.ts
    review.repository.ts
    review-vote.repository.ts
    forum-category.repository.ts
    forum-post.repository.ts
    forum-post-like.repository.ts
    announcement.repository.ts

  services/
    follow.service.ts
    comment.service.ts
    reaction.service.ts
    review.service.ts
    forum.service.ts
    announcement.service.ts
```

---

## 4. Frontend Implementation (Next.js)

### 4.1 Following Authors

Routes under `src/app/(reader-dashboard)/following/`:

```text
src/app/(reader-dashboard)/following/
  page.tsx                           # /following – authors I follow

  _components/
    following-list.tsx
    following-item.tsx
    follow-notification-settings.tsx
```

Author’s followers under `src/app/(author)/followers/`:

```text
src/app/(author)/followers/
  page.tsx                           # /followers – list of readers following this author

  _components/
    follower-list.tsx
    follower-card.tsx
```

### 4.2 Comments & Reactions (Reader View)

Comments usually appear in reader pages: `src/app/(reading)/read/[siteSlug]/[seriesSlug]/[chapterSlug]/_components/`:

```text
comments-section.tsx
comment-item.tsx
comment-list.tsx
comment-form.tsx
reply-list.tsx
reply-form.tsx
comment-actions.tsx
reaction-bar.tsx
reaction-picker.tsx
```

### 4.3 Reviews

Reader reviews UI:

```text
src/app/(reader)/series/[seriesSlug]/reviews/
  page.tsx                           # /series/{slug}/reviews

  _components/
    review-list.tsx
    review-card.tsx
    review-stats.tsx
    review-form.tsx
    rating-stars.tsx
    helpful-vote-buttons.tsx
```

Author review dashboard:

```text
src/app/(author)/reviews/
  page.tsx                           # /author/reviews – reviews on my series

  _components/
    author-review-table.tsx
    author-review-response-form.tsx
```

### 4.4 Announcements

Public site: `src/app/(site)/s/[siteSlug]/announcements/`:

```text
page.tsx                                # /s/{siteSlug}/announcements
[slug]/page.tsx                         # /s/{siteSlug}/announcements/{slug}

_components/
  announcement-card.tsx
  announcement-list.tsx
  announcement-detail.tsx
```

Author-side: `src/app/(author)/announcements/`:

```text
src/app/(author)/announcements/
  page.tsx                             # /announcements – list for author site
  create/
    page.tsx
  [announcementId]/
    edit/
      page.tsx

  _components/
    announcement-table.tsx
    announcement-form.tsx
    publish-toggle.tsx
    pin-toggle.tsx
```

### 4.5 Forum

Public forum: `src/app/(reader)/forum/`:

```text
src/app/(reader)/forum/
  page.tsx                             # /forum – category list
  [categorySlug]/
    page.tsx                           # /forum/{categorySlug}
  post/
    [postId]/
      page.tsx                         # /forum/post/{postId}

  _components/
    forum-category-list.tsx
    forum-post-list.tsx
    forum-post-card.tsx
    forum-post-editor.tsx
    forum-reply-list.tsx
    forum-reply-form.tsx
    forum-like-button.tsx
```

Admin forum management: `src/app/(admin)/admin/forum/`:

```text
src/app/(admin)/admin/forum/
  categories/page.tsx
  posts/page.tsx
  _components/
    forum-category-table.tsx
    forum-category-form.tsx
    forum-post-moderation-table.tsx
```

---

## 5. Hooks & Frontend API Clients

### 5.1 Hooks

```text
src/hooks/
  // Follows
  use-following.ts                 # list authors I follow
  use-author-followers.ts          # list followers of current author
  use-follow-author.ts             # follow/unfollow
  use-update-follow-notifications.ts

  // Comments
  use-chapter-comments.ts          # list + pagination
  use-create-comment.ts
  use-update-comment.ts
  use-delete-comment.ts
  use-replies.ts
  use-pin-comment.ts
  use-hide-comment.ts

  // Reactions
  use-chapter-reactions.ts
  use-comment-reactions.ts
  use-add-reaction.ts
  use-remove-reaction.ts

  // Reviews
  use-series-reviews.ts
  use-create-review.ts
  use-update-review.ts
  use-delete-review.ts
  use-vote-review.ts
  use-my-reviews.ts
  use-author-reviews.ts
  use-respond-to-review.ts

  // Announcements
  use-site-announcements.ts         # list for author
  use-announcement-detail.ts
  use-create-announcement.ts
  use-update-announcement.ts
  use-delete-announcement.ts
  use-publish-announcement.ts
  use-pin-announcement.ts

  // Forum
  use-forum-categories.ts
  use-forum-category.ts
  use-forum-posts.ts
  use-forum-post-detail.ts
  use-create-forum-post.ts
  use-update-forum-post.ts
  use-delete-forum-post.ts
  use-reply-to-post.ts
  use-like-post.ts
  use-unlike-post.ts
  use-search-forum.ts
  use-pin-forum-post.ts
  use-lock-forum-post.ts
  use-hide-forum-post.ts
```

### 5.2 Frontend API Endpoints

```text
src/lib/api/endpoints/follows.ts

export const followsApi = {
  followAuthor: (authorId: string | number) =>
    api.post<void>(`/authors/${authorId}/follow`, {}),
  unfollowAuthor: (authorId: string | number) =>
    api.delete<void>(`/authors/${authorId}/follow`),
  listFollowing: () =>
    api.get<AuthorFollowDto[]>('/following'),
  listAuthorFollowers: (authorId: string | number) =>
    api.get<FollowerDto[]>(`/authors/${authorId}/followers`),
  updateFollowNotifications: (authorId: string | number, data: UpdateFollowNotificationsDto) =>
    api.put<void>(`/authors/${authorId}/follow/notifications`, data),
};
```

```text
src/lib/api/endpoints/comments.ts

export const commentsApi = {
  listForChapter: (chapterId: string, params?: CommentQueryParams) =>
    api.get<Paginated<CommentDto>>(`/chapters/${chapterId}/comments`, params),
  createForChapter: (chapterId: string, data: CreateCommentDto) =>
    api.post<CommentDto>(`/chapters/${chapterId}/comments`, data),
  get: (id: number | string) =>
    api.get<CommentDto>(`/comments/${id}`),
  update: (id: number | string, data: UpdateCommentDto) =>
    api.put<CommentDto>(`/comments/${id}`, data),
  remove: (id: number | string) =>
    api.delete<void>(`/comments/${id}`),

  listReplies: (id: number | string) =>
    api.get<CommentDto[]>(`/comments/${id}/replies`),
  reply: (id: number | string, data: CreateReplyDto) =>
    api.post<CommentDto>(`/comments/${id}/replies`, data),

  pin: (id: number | string) =>
    api.post<void>(`/comments/${id}/pin`, {}),
  unpin: (id: number | string) =>
    api.post<void>(`/comments/${id}/unpin`, {}),
  hide: (id: number | string, data?: HideCommentDto) =>
    api.post<void>(`/comments/${id}/hide`, data || {}),
  unhide: (id: number | string) =>
    api.post<void>(`/comments/${id}/unhide`, {}),
};
```

```text
src/lib/api/endpoints/reactions.ts

export const reactionsApi = {
  // Chapter reactions
  addChapterReaction: (chapterId: string, type: ReactionType) =>
    api.post<void>(`/chapters/${chapterId}/reactions`, { type }),
  removeChapterReaction: (chapterId: string, type: ReactionType) =>
    api.delete<void>(`/chapters/${chapterId}/reactions/${type}`),
  listChapterReactions: (chapterId: string) =>
    api.get<ReactionSummaryDto[]>(`/chapters/${chapterId}/reactions`),

  // Comment reactions
  addCommentReaction: (commentId: number | string, type: ReactionType) =>
    api.post<void>(`/comments/${commentId}/reactions`, { type }),
  removeCommentReaction: (commentId: number | string, type: ReactionType) =>
    api.delete<void>(`/comments/${commentId}/reactions/${type}`),
  listCommentReactions: (commentId: number | string) =>
    api.get<ReactionSummaryDto[]>(`/comments/${commentId}/reactions`),
};
```

```text
src/lib/api/endpoints/reviews.ts

export const reviewsApi = {
  listForSeries: (seriesId: string, params?: ReviewQueryParams) =>
    api.get<Paginated<ReviewDto>>(`/series/${seriesId}/reviews`, params),
  createForSeries: (seriesId: string, data: CreateReviewDto) =>
    api.post<ReviewDto>(`/series/${seriesId}/reviews`, data),
  get: (id: string) =>
    api.get<ReviewDto>(`/reviews/${id}`),
  update: (id: string, data: UpdateReviewDto) =>
    api.put<ReviewDto>(`/reviews/${id}`, data),
  remove: (id: string) =>
    api.delete<void>(`/reviews/${id}`),

  vote: (id: string, data: VoteReviewDto) =>
    api.post<void>(`/reviews/${id}/vote`, data),

  respond: (id: string, data: RespondToReviewDto) =>
    api.post<ReviewDto>(`/reviews/${id}/response`, data),

  listMine: () =>
    api.get<ReviewDto[]>('/reviews/mine'),
  listForAuthor: () =>
    api.get<AuthorReviewDto[]>('/author/reviews'),
};
```

```text
src/lib/api/endpoints/announcements.ts

export const announcementsApi = {
  // Author-side
  listForSite: (siteId: string, params?: AnnouncementQueryParams) =>
    api.get<AnnouncementDto[]>(`/sites/${siteId}/announcements`, params),
  createForSite: (siteId: string, data: CreateAnnouncementDto) =>
    api.post<AnnouncementDto>(`/sites/${siteId}/announcements`, data),
  getForSite: (siteId: string, id: string) =>
    api.get<AnnouncementDto>(`/sites/${siteId}/announcements/${id}`),
  updateForSite: (siteId: string, id: string, data: UpdateAnnouncementDto) =>
    api.put<AnnouncementDto>(`/sites/${siteId}/announcements/${id}`, data),
  deleteForSite: (siteId: string, id: string) =>
    api.delete<void>(`/sites/${siteId}/announcements/${id}`),
  publish: (siteId: string, id: string) =>
    api.post<void>(`/sites/${siteId}/announcements/${id}/publish`, {}),
  unpublish: (siteId: string, id: string) =>
    api.post<void>(`/sites/${siteId}/announcements/${id}/unpublish`, {}),
  pin: (siteId: string, id: string) =>
    api.post<void>(`/sites/${siteId}/announcements/${id}/pin`, {}),
  unpin: (siteId: string, id: string) =>
    api.post<void>(`/sites/${siteId}/announcements/${id}/unpin`, {}),

  // Public side is documented under Public/Discovery
};
```

```text
src/lib/api/endpoints/forum.ts

export const forumApi = {
  listCategories: () =>
    api.get<ForumCategoryDto[]>('/forum/categories'),
  getCategory: (slug: string) =>
    api.get<ForumCategoryDto>(`/forum/categories/${slug}`),

  listPostsInCategory: (slug: string, params?: ForumPostQueryParams) =>
    api.get<Paginated<ForumPostDto>>(`/forum/categories/${slug}/posts`, params),

  createPost: (data: CreateForumPostDto) =>
    api.post<ForumPostDto>('/forum/posts', data),
  getPost: (id: number | string) =>
    api.get<ForumPostDto>(`/forum/posts/${id}`),
  updatePost: (id: number | string, data: UpdateForumPostDto) =>
    api.put<ForumPostDto>(`/forum/posts/${id}`, data),
  deletePost: (id: number | string) =>
    api.delete<void>(`/forum/posts/${id}`),

  replyToPost: (id: number | string, data: CreateForumReplyDto) =>
    api.post<ForumPostDto>(`/forum/posts/${id}/reply`, data),

  likePost: (id: number | string) =>
    api.post<void>(`/forum/posts/${id}/like`, {}),
  unlikePost: (id: number | string) =>
    api.delete<void>(`/forum/posts/${id}/like`),

  search: (params: ForumSearchParams) =>
    api.get<Paginated<ForumPostDto>>('/forum/search', params),

  // Admin/mod
  adminCreateCategory: (data: CreateForumCategoryDto) =>
    api.post<ForumCategoryDto>('/admin/forum/categories', data),
  adminUpdateCategory: (id: string, data: UpdateForumCategoryDto) =>
    api.put<ForumCategoryDto>(`/admin/forum/categories/${id}`, data),
  adminDeleteCategory: (id: string) =>
    api.delete<void>(`/admin/forum/categories/${id}`),

  pinPost: (id: number | string) =>
    api.post<void>(`/forum/posts/${id}/pin`, {}),
  lockPost: (id: number | string) =>
    api.post<void>(`/forum/posts/${id}/lock`, {}),
  hidePost: (id: number | string, data?: HideForumPostDto) =>
    api.post<void>(`/forum/posts/${id}/hide`, data || {}),
  unhidePost: (id: number | string) =>
    api.post<void>(`/forum/posts/${id}/unhide`, {}),
};
```

---

## 6. API Reference – Social Features (~48 Endpoints)

Base URL: `https://api.ownverso.com/v1`

### 6.1 Follows (5 endpoints)

1. **POST `/authors/{authorId}/follow`** – Follow an author.
2. **DELETE `/authors/{authorId}/follow`** – Unfollow an author.
3. **GET `/following`** – List authors the current user follows.
4. **GET `/authors/{authorId}/followers`** – List followers for given author (author-only).
5. **PUT `/authors/{authorId}/follow/notifications`** – Update follow-level notification preferences.

### 6.2 Comments (10 endpoints)

6.  **GET `/chapters/{chapterId}/comments`** – List comments for chapter (with pagination, sorting by newest/most liked).
7.  **POST `/chapters/{chapterId}/comments`** – Add new root-level comment.
8.  **GET `/comments/{id}`** – Get a single comment with its children count.
9.  **PUT `/comments/{id}`** – Edit own comment.
10. **DELETE `/comments/{id}`** – Soft-delete own comment.
11. **GET `/comments/{id}/replies`** – Get replies to a comment.
12. **POST `/comments/{id}/replies`** – Reply to comment.
13. **POST `/comments/{id}/pin`** – Pin comment (author or site-level permission).
14. **POST `/comments/{id}/unpin`** – Unpin comment.
15. **POST `/comments/{id}/hide`** – Hide comment (author/moderator).
16. **POST `/comments/{id}/unhide`** – Unhide comment (mod).

### 6.3 Reactions (6 endpoints)

17. **POST `/chapters/{chapterId}/reactions`** – Add reaction to chapter.
18. **DELETE `/chapters/{chapterId}/reactions/{type}`** – Remove reaction from chapter.
19. **GET `/chapters/{chapterId}/reactions`** – Get aggregate reactions on chapter.
20. **POST `/comments/{commentId}/reactions`** – Add reaction to comment.
21. **DELETE `/comments/{commentId}/reactions/{type}`** – Remove reaction from comment.
22. **GET `/comments/{commentId}/reactions`** – Get aggregate reactions on comment.

### 6.4 Reviews (10 endpoints)

23. **GET `/series/{seriesId}/reviews`** – List reviews for series (with filters: sort by date/rating/helpfulness).
24. **POST `/series/{seriesId}/reviews`** – Create review (reader).
25. **GET `/reviews/{id}`** – Get single review detail.
26. **PUT `/reviews/{id}`** – Update own review.
27. **DELETE `/reviews/{id}`** – Delete own review.
28. **POST `/reviews/{id}/vote`** – Mark review as helpful/unhelpful (`isHelpful` boolean).
29. **POST `/reviews/{id}/response`** – Author responds to review.
30. **GET `/reviews/mine`** – List reviews written by current user.
31. **GET `/author/reviews`** – For authors, list reviews on their series.
32. **(Optional)** `GET /series/{seriesId}/reviews/stats` – summarized stats (average rating, distribution).

### 6.5 Announcements (8 endpoints)

33. **GET `/sites/{siteId}/announcements`** – List announcements for a site (author dashboard).
34. **POST `/sites/{siteId}/announcements`** – Create announcement.
35. **GET `/sites/{siteId}/announcements/{id}`** – Get announcement detail (author-side).
36. **PUT `/sites/{siteId}/announcements/{id}`** – Update announcement.
37. **DELETE `/sites/{siteId}/announcements/{id}`** – Delete announcement.
38. **POST `/sites/{siteId}/announcements/{id}/publish`** – Publish announcement.
39. **POST `/sites/{siteId}/announcements/{id}/unpublish`** – Unpublish announcement.
40. **POST `/sites/{siteId}/announcements/{id}/pin`** – Pin announcement (show prominently).
41. **POST `/sites/{siteId}/announcements/{id}/unpin`** – Unpin.

> Publicly visible announcements are accessed via `/s/{siteSlug}/announcements` and `/s/{siteSlug}/announcements/{slug}`; those will be fully detailed in Public/Discovery.

### 6.6 Forum (approx. 7–10 endpoints counted)

42. **GET `/forum/categories`** – List forum categories (public).
43. **GET `/forum/categories/{slug}`** – Get single category detail (and maybe stats).
44. **GET `/forum/categories/{slug}/posts`** – List posts in category.
45. **POST `/forum/posts`** – Create new thread/post.
46. **GET `/forum/posts/{id}`** – Get post + replies.
47. **PUT `/forum/posts/{id}`** – Edit own post.
48. **DELETE `/forum/posts/{id}`** – Delete own post.
49. **POST `/forum/posts/{id}/reply`** – Reply to an existing post.
50. **POST `/forum/posts/{id}/like`** – Like a post.
51. **DELETE `/forum/posts/{id}/like`** – Unlike a post.
52. **GET `/forum/search`** – Search forum posts.

**Admin/Moderator actions (counted under Social or Moderation):**

53. **POST `/admin/forum/categories`** – Create category.
54. **PUT `/admin/forum/categories/{id}`** – Update category.
55. **DELETE `/admin/forum/categories/{id}`** – Delete category.
56. **POST `/forum/posts/{id}/pin`** – Pin forum post (mod).
57. **POST `/forum/posts/{id}/lock`** – Lock thread (mod).
58. **POST `/forum/posts/{id}/hide`** – Hide post (mod).
59. **POST `/forum/posts/{id}/unhide`** – Unhide post (mod).

This gives ~48–50 endpoints, consistent with the category’s complexity.

---

## 7. Integration With Other Modules

- **Reader Engagement:**
  - Comments, reactions, reviews, forum participation all increment engagement metrics (`ReaderEngagementScore`, `AnalyticsEvent`).

- **Moderation:**
  - Comments, reviews, forum posts are common targets of `Report` and `ModerationLog`.
  - The Social module calls Moderation module hooks on hide/remove actions.

- **Notifications:**
  - New comments, replies, mentions, reviews, and follows generate notifications:
    - e.g., `NotificationType.COMMENT`, `COMMENT_REPLY`, `NEW_SUBSCRIBER`, `REVIEW`.

- **Analytics:**
  - Actions like `COMMENT_POSTED`, `REVIEW_POSTED`, `REACTION` create `AnalyticsEvent` entries.

- **Public/Discovery:**
  - Public author pages may display follower count, top reviews, and announcement snippets.

---

